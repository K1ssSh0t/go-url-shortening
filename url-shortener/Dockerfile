# Etapa de construcci贸n
FROM golang:1.24.1-alpine AS builder

# Establecer directorio de trabajo
WORKDIR /app

# Copiar archivos de m贸dulos Go
COPY go.mod go.sum ./

# Descargar dependencias
RUN go mod download

# Copiar todo el c贸digo fuente
COPY . .

# Construir la aplicaci贸n
RUN CGO_ENABLED=0 GOOS=linux go build -o url-shortener ./cmd/main.go

# Etapa final
FROM alpine:latest

# Instalar certificados CA para HTTPS
RUN apk --no-cache add ca-certificates

WORKDIR /root/

# Copiar el binario construido
COPY --from=builder /app/url-shortener .

# Exponer puerto
EXPOSE 8080

# Comando para ejecutar
CMD ["./url-shortener"]